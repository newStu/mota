# 公共内容

## 基础类 CommonProperty

```javascript
import { MapTiles, defaultPosition } from "@/constants";
import type {
  CommonFuncMap,
  ExecuteReturnType,
  IDType,
  OneElementType,
  PositionType,
  RenderResult,
} from "@/typings/constants";
import { cloneDeep } from "lodash";
import type { Hero } from "../role";

export class CommonProperty {
  id: IDType;
  x: number;
  y: number;
  width: number = 1;
  height: number = 1;

  constructor(
    id: IDType = MapTiles.ROAD,
    position: PositionType = defaultPosition
  ) {
    this.id = id;
    this.x = position.x;
    this.y = position.y;
  }

  addToRender(x: number, y: number, _element?: OneElementType): any {
    const item = cloneDeep(this);
    item.x = x;
    item.y = y;

    return item;
  }

  getRenderKey() {
    return this.id + "_" + this.x + "_" + this.y;
  }

  /**
   * 执行操作,返回false代表不能继续往前进
   * @param _hero 英雄信息
   * @param _commonFuncMap 所有公共操作方法集合
   * @returns
   */
  execute(_hero: Hero, _commonFuncMap?: CommonFuncMap): ExecuteReturnType {
    return { flag: false };
  }
}
```

> 公共类,提供公共的位置信息,设置 id,默认宽高为1，部分特殊元素可能会超出这个宽高
>
> 公共方法：
>
> `addToRender`：添加到地图上的方法，默认是`clone`一个当前对象返回。因为不`clone`无法展示多个。有部分元素只需要一页展示一个就不需要`clone`,而是改变位置即可，这个时候就可以直接通过继承后重写该方法即可,比如`hero`。还有一些元素，元素占用1个格子，但是实际位置可能占用多个格子，需要返回转发对象，如`商店`
>
> `execute`: 英雄移动到当前位置后会调用的方法
>
> + 返回值对象
>   + `flag`: 判断是否可以继续前进的方法，默认为`false`无法前进。 
>   + `isFight`：是否进行打架，在`Role`类中一般都会返回`true`
>   + 一般可以移动的情况都会将原先的元素移除掉，后续可以根据需要添加其他标识，可以不移除当前元素而直接移动。
>
> + 参数
>   + `hero`: 一般都是和英雄进行交互，所以第一个元素为英雄实例
>   + `commonFuncMap`：公共方法。所有的公共方法都放在当前对象传入里面，包含消息提示，开启商店，初始化对话弹窗，上一层，下一层等操作，要拓展一些公共能力都需要放在这里



## id 枚举值定义【[id](../src/constants/id)】

- `MapTiles`: 地图元素 id 枚举
- `RoleTiles`: 角色 id 枚举
- `NPCTiles`: NPC id 枚举
- `PropTiles`: 道具 id 枚举

> 枚举的规则:
>
> - `MapTiles`: 直接使用数字
> - `RoleTiles`: `R`: 继承 Role 类, `H`: 角色枚举首字母, `0`: 顺序值



## 公共图片素材 【[imageMaterial](../src/constants/imageMaterial/index.ts)】

- `MapTilesImage`: 地图元素图片集合
- `RoleTilesImage`: 角色元素图片集合
- `NPCTilesImage`: NPC 元素图片集合
- `PropTilesImage`: 道具元素图片集合
- `TilesImage`: 所有图片元素图片集合



## 公共基础属性【[numerical](../src/constants/numerical)】

- `RoleNumerical`: 角色基础属性
- `MapNumerical`: 地图基础属性



## 渲染选择列表【[selectList](../src/render/selectList.ts)】

- `selectMapTilesList`: 地图元素列表
- `selectRoleTilesList`: 角色元素列表
- `selectPropTilesList`: 道具元素列表
- `abilityList`: 能性道具列表
- `renderElementTabs`: 以以上数据集合成的tab数据



## 页面

- [首页](../src/views/HomeView.vue)
- [游戏页](../src/views/Game.vue)
- [编辑游戏关卡页](../src/views/EditView.vue)



## 公共Hooks

+ [useElementInteractive](../src/hooks/useElementInteractive.ts): 英雄与元素之间互动的主要方法
+ [useInit](../src/hooks/useInit.ts):初始化关卡，地图数据的主要方法
+ [useLocalStorageSaveGame](../src/hooks/useLocalStorageSaveGame.ts):主要缓存游戏的主要方法
+ [useRenderGameInfo](../src/hooks/useRenderGameInfo.ts):主要是获取渲染游戏相关数据的方法，为了保存等操作
+ [useElementStyle](../src/hooks/useStyle.ts):主要是获取原始展示在页面上样式问题



## 渲染元素

+ [element](../src/render/element.ts):元素的id与元素类对应关系
+ [selectList](../src/render/selectList.ts):地图编辑右侧选择元素的列表





## 全局Stores

### 公共部分: 不管编辑还是游戏都需要使用

+ [common](../stores/common/common.ts): 公共数据，如1 * 1  的元素大小与样式
+ [elementRender](../stores/common/elementRender.ts):  地图中除开Hero外的所有元素渲染的列表
  + renderList:  其他渲染元素
  + forwardMap: 转发对象
+ [game](../stores/common/game.ts): 关卡数据
  + prevGameLevels： 上一关
  + nextGameLevels： 下一关
  + gameLevels：当前游戏关卡
  + levelList：关卡数据
  + initHeroInfo：初始化的英雄数据
+ [hero](../stores/common/hero.ts): 处理英雄移动操作，以及初始化英雄数值
  + heroWithElementInteractive：这里判断hero与元素之间的互动操作
+ [map](../stores/common/map.ts): 地图数据
  + map: 渲染的数组
  + initMap: 初始化地图数据
  + isInnerMap: 判断坐标是否在地图内

### 地图编辑使用部分：editMap

+ [elementSelect](../stores/common/editMap/elementSelect.ts): 元素选择功能
+ [shortcut](../stores/common/editMap/shortcut.ts):  地图编辑的时候的快捷方式



### 游戏使用部分：game

+ [talk](../stores/common/game/talk.ts): 对话系统







## 组件【[components](../src/components)】



### [公共组件](../src/components/Common)

#### 【[DataPanel](../src/components/Common/DataPanel.vue)】数据面板组件

渲染游戏除地图外的其他内容，这一块可能要再进行优化分离，减少游戏状态的覆盖，为编辑地图添加更多新功能

#### 【[InputText](../src/components/InputText.vue)】输入框和文本公共组件

输入框和文本切换的组件 

#### 【[Map](../src/components/Common/Map.vue)】地图组件

主要是渲染地图行列的组件，默认以路作为背景，如果后续需要修改背景，可以在这里做一些定制化



#### 【[SizeSlider](../src/components/Common/SizeSlider.vue)】放大缩小地图器



### [元素选择-属性编辑组件](../src/components/EditSelect)

#### 【[AttributePanel](../src/components/EditSelect/AttributePanel.vue)】属性面板

编辑地图元素的属性

#### 【[CommonSelect](../src/components/EditSelect/CommonSelect.vue)】公共的选择元素显示板块

左侧选择元素的面板

#### 【[MapAttr](../src/components/EditSelect/MapAttr.vue)】地图属性面板

地图的一些属性设置

+ row
+ col

> TODO：后续可以拓展背景图片



#### 【[ShortcutPanel](../src/components/EditSelect/ShortcutPanel.vue)】地图编辑快捷选项

+ 开启辅助定位线
+ 单击删除元素
+ 选择地图元素
+ TODO: 地图元素互换: 选择一个地图元素,然后再点击其他位置,让两个元素之间的位置互换
+ TODO: 开启批量移除: 这个是可以使用鼠标移动事件移除元素
+ TODO: 批量移除: 这个是先选择需要批量移除的单位,然后点击该按钮就会批量移除元素



### [地图编辑组件](../src/components/EditView)

#### 【[EditMapRender](../src/components/EditView/EditMapRender.vue)】地图编辑渲染组件

+ [EditElementBlock](../src/components/EditView/components/EditElementBlock.vue): 渲染元素【角色，道具，地图元素】
+ [EditRoad](../src/components/EditView/components/EditRoad.vue): 路面组件，主要是触发点击之类的事件，然后将数据添加到`renderList`中去
  + `addToRender`方法只在这里调用
+ [UseMouse](../src/components/EditView/components/UseMouse.vue): 鼠标定位组件，获取鼠标的x，y从而设置MapTag的高亮和MapLine线条位置
+ [MapTag](../src/components/EditView/components/MapTag.vue): `x,y`轴坐标辅助
+ [MapLine](../src/components/EditView/components/MapLine.vue): 地图辅助线



### [游戏相关组件](../src/components/GameView)

#### 【[MapRender](../src/components/GameView/MapRender.vue)】地图渲染组件

+ [Element](../src/components/GameView/Element.vue): 渲染除英雄外所有元素【角色，道具，地图元素】
+ [HeroElement](../src/components/GameView/components/HeroElement.vue): 专门渲染英雄的组件，按键绑定在这里
+ [Road](../src/components/GameView/components/Road.vue): 路组件，暂时不使用

#### 【[Talk](../src/components/GameView/Talk.vue)】对话组件





## 工具类： utils

+ [common](../utils/common.ts): 公共工具函数
  + heroFightMonster: 英雄战斗的快速计算方法
  + heroFightMonsterRound: 英雄回合制战斗方法
+ [message](../utils/message.ts): 消息类工具函数
+ [position](../utils/position.ts): 位置信息工具函数
  + getRealXY: 计算真的计算逻辑
  + getForwardPosition: 获取转发地址





 
